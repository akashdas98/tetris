!function(e){var t={};function r(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(a,o,function(t){return e[t]}.bind(null,o));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);const a=document.querySelector("canvas"),o=a.getContext("2d");a.height=600,a.width=300;var c={createPiece(e,t,r,a){let c=0;return{draw:function(){o.fillStyle=a,o.strokeStyle="#000000",e.forEach(e=>{o.globalAlpha=1,o.fillRect(30*(e[0]+t[0]),30*(e[1]+t[1]),30,30),o.globalAlpha=.5,o.strokeRect(30*(e[0]+t[0]),30*(e[1]+t[1]),30,30)})},setPivot:function(e,r){t=[e,r]},getPivot:function(){return t},getMatrix:function(){return e},rotate:function(a,o){if("O"===r)return;let n,i;n=0===a?[[0,1],[-1,0]]:[[0,-1],[1,0]];let l=!1;function f(e,r){l=!1;for(let a=0;a<i.length;a++){if(i[a][0]+t[0]+e<0||i[a][0]+t[0]+e>9||i[a][1]+t[1]+r>19){l=!0;break}if(1===o[i[a][0]+t[0]+e][i[a][1]+t[1]+r].value){l=!0;break}}}function u(r,o){e=i,t[0]+=r,t[1]+=o,c=1==a?((c+1)%4+4)%4:((c-1)%4+4)%4}i=e.map(e=>{return r=e,[(t=n)[0][0]*r[0]+t[0][1]*r[1],t[1][0]*r[0]+t[1][1]*r[1]];var t,r}),"I"===r?0===c?1===a?(f(0,0),l?(f(-2,0),l?(f(1,0),l?(f(-2,-1),l?(f(1,2),l||u(1,2)):u(-2,-1)):u(1,0)):u(-2,0)):u(0,0)):(f(0,0),l?(f(-1,0),l?(f(2,0),l?(f(-1,2),l?(f(2,-1),l||u(2,-1)):u(-1,2)):u(2,0)):u(-1,0)):u(0,0)):1===c?1===a?(f(0,0),l?(f(-1,0),l?(f(2,0),l?(f(-1,2),l?(f(2,-1),l||u(2,-1)):u(-1,2)):u(2,0)):u(-1,0)):u(0,0)):(f(0,0),l?(f(2,0),l?(f(-1,0),l?(f(2,1),l?(f(-1,-2),l||u(-1,-2)):u(2,1)):u(-1,0)):u(2,0)):u(0,0)):2===c?1===a?(f(0,0),l?(f(2,0),l?(f(-1,0),l?(f(2,1),l?(f(-1,-2),l||u(-1,-2)):u(2,1)):u(-1,0)):u(2,0)):u(0,0)):(f(0,0),l?(f(1,0),l?(f(-2,0),l?(f(1,-2),l?(f(-2,1),l||u(-2,1)):u(1,-2)):u(-2,0)):u(1,0)):u(0,0)):3===c&&(1===a?(f(0,0),l?(f(1,0),l?(f(-2,0),l?(f(1,-2),l?(f(-2,1),l||u(-2,1)):u(1,-2)):u(-2,0)):u(1,0)):u(0,0)):(f(0,0),l?(f(-2,0),l?(f(1,0),l?(f(-2,-1),l?(f(1,2),l||u(1,2)):u(-2,-1)):u(1,0)):u(-2,0)):u(0,0))):0===c?1===a?(f(0,0),l?(f(-1,0),l?(f(-1,1),l?(f(0,-2),l?(f(-1,-2),l||u(-1,-2)):u(0,-2)):u(-1,1)):u(-1,0)):u(0,0)):(f(0,0),l?(f(1,0),l?(f(1,1),l?(f(0,-2),l?(f(1,-2),l||u(1,-2)):u(0,-2)):u(1,1)):u(1,0)):u(0,0)):1===c?(f(0,0),l?(f(1,0),l?(f(1,-1),l?(f(0,2),l?(f(1,2),l||u(1,2)):u(0,2)):u(1,-1)):u(1,0)):u(0,0)):2===c?1===a?(f(0,0),l?(f(1,0),l?(f(1,1),l?(f(0,-2),l?(f(1,-2),l||u(1,-2)):u(0,-2)):u(1,1)):u(1,0)):u(0,0)):(f(0,0),l?(f(-1,0),l?(f(-1,1),l?(f(0,-2),l?(f(-1,-2),l||u(-1,-2)):u(0,-2)):u(-1,1)):u(-1,0)):u(0,0)):3===c&&(f(0,0),l?(f(-1,0),l?(f(-1,-1),l?(f(0,2),l?(f(-1,2),l||u(-1,2)):u(0,2)):u(-1,-1)):u(-1,0)):u(0,0))},getColor:function(){return a}}},createTPiece(e,t){return this.createPiece([[0,-1],[-1,0],[0,0],[1,0]],[e,t],"T","#ff00ff")},createIPiece(e,t){return this.createPiece([[-1.5,.5],[-.5,.5],[.5,.5],[1.5,.5]],[e,t],"I","#00ffff")},createJPiece(e,t){return this.createPiece([[-1,0],[0,0],[1,0],[-1,-1]],[e,t],"J","#0000ff")},createLPiece(e,t){return this.createPiece([[-1,0],[0,0],[1,0],[1,-1]],[e,t],"L","#ff7f00")},createSPiece(e,t){return this.createPiece([[-1,0],[0,0],[0,-1],[1,-1]],[e,t],"S","#00ff00",o,30)},createOPiece(e,t){return this.createPiece([[-1,0],[0,0],[-1,-1],[0,-1]],[e,t],"O","#ffff00")},createZPiece(e,t){return this.createPiece([[-1,-1],[0,0],[0,-1],[1,0]],[e,t],"Z","#ff0000")}};(function(){let e,t,r,n,i,l=99,f=d(),u=[],s=!0,h=0;for(let e=0;e<10;e++)u[e]=[];function v(){h=0,s=!1,e=f,f=d(),e.draw(),r=e.getPivot(),t=e.getMatrix(),P(100)}function d(){let e;switch(function(){let e=Math.floor(7*Math.random());return e===l&&(e=Math.floor(7*Math.random())),l=e,e}()){case 0:e=c.createTPiece(5,-1);break;case 1:e=c.createIPiece(4.5,-1.5);break;case 2:e=c.createJPiece(5,-1);break;case 3:e=c.createLPiece(5,-1);break;case 4:e=c.createSPiece(5,-1);break;case 5:e=c.createOPiece(5,-1);break;case 6:e=c.createZPiece(5,1)}return e}function P(c){i=setInterval(()=>{r=e.getPivot(),t=e.getMatrix();for(let e=0;e<t.length;e++)if(t[e][1]+r[1]>=0&&(t[e][1]+r[1]===19||1===u[t[e][0]+r[0]][t[e][1]+r[1]+1].value))return clearInterval(i),s=!0,clearTimeout(n),void(n=setTimeout(()=>{s&&(g(),p(),v())},1e3));o.clearRect(0,0,a.width,a.height),e.setPivot(r[0],r[1]+1),e.draw(),b()},c)}function b(){u.forEach((e,t)=>{e.forEach((e,r)=>{1===u[t][r].value&&(o.fillStyle=u[t][r].color,o.strokeStyle="#000000",o.globalAlpha=1,o.fillRect(30*t,30*r,30,30),o.globalAlpha=.5,o.strokeRect(30*t,30*r,30,30))})})}function g(){t.forEach(t=>{u[t[0]+r[0]][t[1]+r[1]].value=1,u[t[0]+r[0]][t[1]+r[1]].color=e.getColor()})}function p(){for(let e=0;e<20;e++){let t=1;for(let r=0;r<10;r++)1!==u[r][e].value&&(t=0);if(1===t){for(let t=0;t<10;t++)u[t][e].value=0,u[t][e].color=null;for(let t=e-1;t>=0;t--)for(let e=0;e<10;e++)u[e][t+1]=u[e][t]}}b()}return u.forEach(e=>{for(let t=0;t<20;t++)e[t]={value:0,color:null}}),window.addEventListener("keydown",(function(c){let l=1;if(10!==h){switch(c.key){case"ArrowLeft":t.forEach(e=>{e[0]+r[0]===0?l=0:u[e[0]+r[0]-1][e[1]+r[1]]&&1===u[e[0]+r[0]-1][e[1]+r[1]].value&&(l=0)}),1===l&&e.setPivot(r[0]-1,r[1]),l=1;break;case"ArrowRight":t.forEach(e=>{e[0]+r[0]===9?l=0:u[e[0]+r[0]+1][e[1]+r[1]]&&1===u[e[0]+r[0]+1][e[1]+r[1]].value&&(l=0)}),1===l&&e.setPivot(r[0]+1,r[1]),l=1;break;case"ArrowDown":t.forEach(e=>{e[1]+r[1]>=0&&(e[1]+r[1]===19?l=0:u[e[0]+r[0]][e[1]+r[1]+1]&&1===u[e[0]+r[0]][e[1]+r[1]+1].value&&(l=0))}),1===l&&(clearInterval(i),P(50)),l=1;break;case"ArrowUp":e.rotate(1,u),l=1;break;case" ":e.rotate(0,u),l=1}if(r=e.getPivot(),t=e.getMatrix(),o.clearRect(0,0,a.width,a.height),e.draw(),b(),s){for(let e=0;e<t.length;e++)t[e][1]+r[1]>=0&&(t[e][1]+r[1]!==19&&1!==u[t[e][0]+r[0]][t[e][1]+r[1]+1].value||(l=0));1===l&&(s=!s,clearInterval(i),P(100),h=0),clearTimeout(n),n=setTimeout(()=>{s&&(g(),p(),v(),h=0)},1e3),h++}}})),window.addEventListener("keyup",e=>{"ArrowDown"===e.key&&(clearInterval(i),s||P(100))}),{start:v}})().start()}]);